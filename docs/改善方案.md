# Obsidian Local Images 插件移动端兼容性改善方案

## 目标
1. 支持在移动端（iOS/Android）获取图片。
2. 支持在移动端保存图片到指定目录。

---

## 现状分析
- 现有插件依赖 Node.js 专用模块（如 got、file-type、fs、path 等），这些在移动端无法使用。
- Obsidian 移动端 API 支持有限，文件操作、网络请求等需使用 Web 标准或 Obsidian 官方 API。

---

## 改善方案

### 1. 获取图片（移动端兼容）
- **替换 Node.js 网络库**：将 `got` 等 Node.js 网络库替换为浏览器原生 `fetch` API。
- **图片类型识别**：使用图片扩展名或 MIME 类型（通过 fetch 的 response.headers）判断图片类型，避免 file-type 等 Node.js 库。
- **错误处理**：增加网络异常、格式不支持等提示。

#### 示例：
```typescript
// 替换 got 为 fetch
const response = await fetch(imageUrl);
if (!response.ok) throw new Error('图片下载失败');
const blob = await response.blob();
```

### 2. 保存图片（移动端兼容）
- **使用 Obsidian Vault API**：通过 `this.app.vault.createBinary()` 或 `this.app.vault.create()` 保存图片。
- **目录处理**：使用 Obsidian API 检查/创建目录，避免直接操作文件系统。
- **路径兼容**：确保路径拼接兼容移动端，避免 path.join 等 Node.js 方法。

#### 示例：
```typescript
// 保存图片到 vault
await this.app.vault.createBinary(targetPath, blob);
```

### 3. 代码结构调整
- **平台检测**：在插件初始化时检测运行环境（桌面/移动），根据平台切换实现。
- **降级处理**：移动端不支持的功能需提示或隐藏。
- **文档与注释**：补充移动端相关说明，便于维护。

### 4. 测试与发布
- 在 iOS/Android 设备上进行功能测试，确保图片获取与保存流程无误。
- 收集用户反馈，持续优化兼容性。

---

## 参考资料
- [Obsidian 官方 API 文档](https://docs.obsidian.md/Reference/TypeScript+API/)
- [Obsidian Mobile 插件兼容性讨论](https://forum.obsidian.md/t/mobile-plugin-support/)

---

## 后续计划
- 优化图片处理性能，减少移动端资源消耗。
- 增加更多移动端友好设置，如图片压缩、自动重命名等。

---

如需进一步技术支持，请联系插件维护者。
